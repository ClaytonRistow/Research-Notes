\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[margin=1in]{geometry}
\geometry{a4paper}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[mathscr]{euscript}
\usepackage{tikz}

\title{Tree Enumeration}
\author{Clayton Ristow}
\date{18 June 2015}

\begin{document}
\maketitle
 
To derive the generating function for an annealed branched polymer, we need a method for counting the number of branched polymers with a specific number of nodes. We will use graph theory to count these possible arrangements of branches. However, we do not with to enumerate all graphs. We will limit ourselves to the following types our graphs.
\begin{itemize}
\item The graph will be not contain any closed loops. In other words the graphs are acyclic. 
\item The graph will be connected meaning there will be no unattached nodes. These first two qualifications define a graph called a tree. An example of a tree is shown in figure 1.
\item Each node on the graph will have no more than 3 branches protruding from it. In our model of RNA folding in on itsself, it would be highly unlikely that the RNA would fold in such a way that there would be a four way intersecion exactly. In most cases where there appears to be such an intersection, we can model it with two three way intersections sepearted by a very small branch
\end{itemize}

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.8, every node/.style={circle,draw}]
\node (n1) at (1,7) {1};
\node (n2) at (1,3) {2};
\node (n3) at (3,5) {3};
\node (n4) at (6,5) {4};
\node (n5) at (8,7) {5};
\node (n6) at (8,3) {6};

\foreach \from/\to in {n1/n3,n2/n3,n3/n4,n4/n5,n4/n6}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{A basic tree}
\end{figure}

\section{Polya's Enumeration Theorem}
Polya's Enumeration Theorem provides us with a very usefull tool for counting graphs. Say we have a graph G and we want to know the number of different ways to color the nodes on our graph black or white. However, we are allowed to twist rotate and flip our graph in any way as long as the connections between nodes remains constant. For example, the two decorated graphs in figure 2 are identical. 

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.5]
\tikzset{marked/.style={circle,draw,fill=black!50}}
\tikzset{unmarked/.style={circle,draw}}
\node [marked] (n1) at (1,7) {1};
\node [unmarked] (n2) at (1,3) {2};
\node [marked] (n3) at (3,5) {3};
\node [unmarked] (n4) at (6,5) {4};
\node [unmarked]  (n5) at (8,7) {5};
\node [unmarked] (n6) at (8,3) {6};

\node [unmarked] (n11) at (11,7) {1};
\node [marked] (n12) at (11,3) {2};
\node [marked] (n13) at (13,5) {3};
\node [unmarked] (n14) at (16,5) {4};
\node [unmarked]  (n15) at (18,7) {5};
\node [unmarked] (n16) at (18,3) {6};

\foreach \from/\to in {n1/n3,n2/n3,n3/n4,n4/n5,n4/n6,n11/n13,n12/n13,n13/n14,n14/n15,n14/n16}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{These decorated trees are identical}
\end{figure}

We must develop some technique to deal with over counting in these situations. The answer is Polya's Enumeration Theorem. 
For every method of decorating a graph there is a decoration function 

 \begin{equation}
f(x)=f_0+f_1x+f_2x^2+f_3x^3...
\end{equation}

such that \(f_n\) is the number of ways to arrange n "somthings" on a specific node.
For every graph G there is a group of permutations \(P_G\) such that when \(P_G\) acts on the set of nodes the set of edges does not change. From this group, we may generate what is called the cycle index. the cycle index is defined as follows. Its is an elementary fact that a permutation can be written as the composition of disjoint cycles. So for each element g of the group \(P_G\) we can write what is called the cycle monomial as 

\begin{equation}
Cycle Monomial=\prod_k S_k^{j_k(g)}
\end{equation}

where k is the length of the cycle and \(j_k(g)\) is the number of cycles of length k in the element g
The cycle index \(Z_G\) is simply the sum of cycle monomials over all group elements.
 
\begin{equation}
Z_G(S_1,S_2,S_3...) \equiv \frac{1}{|P_G|}\sum_{g\in P_G} \prod_k S_k^{j_k(g)}
\end{equation}

Then finally, Polya's Enumeration Theorem says:
Let G be a graph. Let \(F(x)\) be a power series 
\begin{equation}
F(x)=F_0+F_1x+F_2x^2...
\end{equation}
where \(F_n\) is the number of ways to represent the graph with n nodes decorated. Then we may compute \(F(x)\) as
\begin{equation}
F(x)=Z_G(f(x),f(x^2),f(x^3)...)
\end{equation}
where f(x) is the decoration function and \(Z_G\) is the cycle index. 

let us use the Graph in figure 1 as an example. 
It is quite simple to find \(P_G\) for our graph in figure 1. Written in cyclic notation the permutation group is:
\begin{equation}
P_G=\{e,(12),(56),(12)(56),(1625)(34), (1526)(34),(16)(25)(34),(15)(26)(34)\}
\end{equation} 
So the cycle index is
\begin{equation}
Z_G=\frac{1}{8} (S_1^6+2S_1^4S_2^1+2S_4^1S_2^1+2S_2^3)
\end{equation}
 and because there is one way to not color in a node and one way to color in a node we can write the decoration function as
\begin{equation}
f(x)=1+x
\end{equation}
Applying Polyas Enumeration Theorem, we get 
\begin{equation}
F(x)=\frac{1}{8}((1+x)^6+2(1+x)^4(1+x^2)+2(1+x^4)(1+x^2)+2(1+x^2)^3)
\end{equation}
Which simplified becomes
\begin{equation}
F(x)=1+2x+5x^2+5x^3+5x^4+2x^5+x^6
\end{equation}
which tells us that there is one way to color in no nodes, 2 ways to color in 1 node, 5 ways to color in 2, 3, or 4 nodes, 2 ways to  color in 5 nodes, and 1 way to color in all the nodes. 

\section{Planted Trees}
We now have the tools nessessary to start enumerating some trees. We will first look at planted trees. Planted trees are a special type of tree that start with a special node that has one branch coming off of it in one direction. An example is shown in figure 3. The square node represents the special node that starts the planted tree. 
 
\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.4]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (5,1) {};
\node [circ] (n2) at (5,3) {};
\node [circ] (n3) at (3,5) {};
\node [circ] (n4) at (7,5) {};
\node [circ] (n5) at (2,7) {};
\node [circ] (n6) at (4,7) {};
\node [circ] (n7) at (7,7) {};

\foreach \from/\to in {n1/n2,n2/n3,n2/n4,n4/n7,n3/n5,n3/n6}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{A planted tree}
\end{figure}

We want to find a formula to count the number of planted trees with n nodes. To do this we will find \(F(x)=F_0+F_1x+F_2x^2...\) where \(F_n\) is the number of planted trees with n nodes. We can map out the first few easily by hand (Fig. 4):

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.7]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (1,1) {};
\node [circ] (n2) at (1,3) {};
\node at (2.5,1) {,};
\node [sq]  (n3) at (4,1) {};
\node [circ] (n4) at (4,3) {};
\node [circ] (n5) at (4,5) {};
\node at (5.5,1) {,};
\node [sq] (n6) at (7,1) {};
\node [circ] (n7) at (7,3) {};
\node [circ] (n8) at (7,5) {};
\node [circ] (n9) at (7,7) {};
\node [sq] (n10) at (9,1) {};
\node [circ] (n11) at (9,3) {};
\node [circ] (n12) at (8,5) {};
\node [circ] (n13) at (10,5) {};
\node at(11.5,1) {, . . .};

\foreach \from/\to in {n1/n2,n3/n4,n4/n5,n6/n7,n7/n8,n8/n9,n10/n11,n11/n12,n11/n13}
	\draw (\from) -- (\to);
\end{tikzpicture}
\caption{All of the planted trees with 2, 3, of 4 nodes}
\end{figure}

However, to enumerate for larger n, we can find a functional equation for \(F(x)\) by decorating the trees with other rooted trees. By definition the tree must start with a square node connected to a normal circular node as shown in figure 5. 

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.7]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (1,1) {};
\node [circ] (n2) at (1,3) {};

\foreach \from/\to in {n1/n2}
	\draw (\from) -- (\to);
\end{tikzpicture}
\caption{All planted trees start this way}
\end{figure}

This starting graph has two nodes already so whatever is attached to the top node will already have two nodes attached to it. So we start the functional equation as:
\begin{equation}
F(x)=x^2(\text{number of ways to attach planted trees to the top node})
\end{equation}

There are 3 ways to attach planted trees to the top node given our framework (Fig. 6). Our options are attach nothing to the top node, attach 1 planted tree to the top node or attach 2 planted trees to the top node.

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.7]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (1,1) {};
\node [circ] (n2) at (1,3) {};
\node at (2.5,1) {,};
\node [sq]  (n3) at (4,1) {};
\node [circ] (n4) at (4,3) {};
\node (n5) at (4,5) {};
\node at (5.5,1) {,};
\node [sq] (n6) at (7,1) {};
\node [circ] (n7) at (7,3) {};
\node (n8) at (6,5) {};
\node (n9) at (8,5) {};

\foreach \from/\to in {n4/n5,n7/n8,n7/n9}
	\draw [dashed] (\from) -- (\to);
\foreach \from/\to in {n1/n2,n3/n4,n6/n7}
	\draw (\from) -- (\to);
\end{tikzpicture}
\caption{3 ways to decorate the two node starter graph: 0, 1, or 2 planted trees}
\end{figure}

Now let us enumerate each way of decorating the graph.There is clearly only one way to add no planted trees on the top node so this decoration contributes 1. Next, the number of ways to add one planted trees is simply the number of planted trees there are to add, which is represented by F(x). However by adding the square node on top of the circular node we are over counting the nodes by 1 so we must divide by x to lower the node count by 1. Thus adding one planted tree contributes \(\frac{F(x)}{x}\). Adding two trees becomes a little tricky. Clearly the branched graphs can flip sides with out chaning the enitre graph so we will be over counting the total number of graphs. We can use Polya's Enumeration Theorem to deal with this overcounting. Flipping two things results in a symmetry group isomorphic to the symmetric group of order 2. Our decoration function is the number of planted trees so our decoration function is \(F(x)\). Finally, since we are adding two square nodes on top of the top node we must divide by \(x^2\) to adjust for over counting these nodes. So the contribution from adding 2 planted trees is \(\frac{1}{x^2}(Z_{S_2}(F(x),F(x^2),F(x^3)...))\). Combining all of these contributions and plugging into Eq. 11 we get:
\begin{equation}
F(x)=x^2(1+\frac{F(x)}{x}+\frac{1}{x^2}(Z_{S_2}(F(x),F(x^2),F(x^3)...)))
\end{equation}
 
The symmetric group of order 2 written in cyclic notation is 
\begin{equation}
S_2=\{e,(12)\}
\end{equation}
Clearly then its cycle index is 
\begin{equation}
Z_{S_2}=\frac{1}{2}(S_1^2+S_2^1)
\end{equation}
Then plugging this cycle index into equation 12 we get:
\begin{equation}
F(x)=x^2(1+\frac{F(x)}{x}+\frac{1}{2x^2}(F^2(x)+F(x^2))
\end{equation}
And then from simplyfing we arrive at our functional equation:
\begin{equation}
F(x)=x^2+ xF(x)+\frac{1}{2}F^2(x)+\frac{1}{2}F(x^2)
\end{equation}

We can find a recursive formula for \(F_n\) fairly easily by remembering the \(F(x)\) is a power series written as 
\begin{equation}
F(x)=\sum_{n=0}^\infty F_nx^n
\end{equation}
Then we can plug this power series into the functional equation to get
\begin{equation}
\sum_{n=0}^\infty F_nx^n=x^2+\sum_{n=0}^\infty F_nx^{n+1}+\frac{1}{2}\sum_{n=0}^\infty \sum_{m=0}^\infty F_n F_mx^{m+n}+\frac{1}{2}\sum_{n=0}^\infty F_nx^2n
\end{equation}
We can equate like powers of x to each other so if n is greater than 2 we get:
\begin{equation}
F_nx^n=
\begin{cases}
F_{n-1}x^n+\frac{1}{2}\sum_{i=0}^nF_iF_{n-i}x^n+\frac{1}{2}F_{\frac{n}{2}}x^n &\text{if } x \text{ is even} \\
F_{n-1}x^n+\frac{1}{2}\sum_{i=0}^nF_iF_{n-i}x^n & \text{if }x \text{ is odd} 
\end{cases}
\end{equation}
then canceling the \(x^n\) and expanding we get:
\begin{equation}
F_n=
\begin{cases}
F_{n-1}+ \frac{1}{2}(F_0F_n+F_1F_{n-1}+...+F_{n-1}F_1+F_nF_0)+\frac{1}{2}F_{\frac{n}{2}} &\text{if } x \text{ is even} \\
F_{n-1}+\frac{1}{2} (F_0F_n+F_1F_{n-1}+...+F_{n-1}F_1+F_nF_0) & \text{if }x \text{ is odd} 
\end{cases}
\end{equation}
which can be consolidated as
\begin{equation}
F_n=
\begin{cases}
F_{n-1}+ \frac{1}{2}(2F_0F_n+2F_1F_{n-1}+...+F_n^2)+\frac{1}{2}F_{\frac{n}{2}} &\text{if } x \text{ is even} \\
F_{n-1}+\frac{1}{2} (2F_0F_n+2F_1F_{n-1}+...+2F_{\frac{n}{2}-1}F_{\frac{n}{2}+1}) & \text{if }x \text{ is odd} 
\end{cases}
\end{equation}
and then if we recall that \(F_0=F_1=0\) we can write a final recurrance relation:
\begin{equation}
F_n=
\begin{cases}
F_{n-1}+\sum_{i=2}^{\frac{n}{2}-1}F_iF_{n-i}+\frac{1}{2}(F_{\frac{n}{2}}+F_{\frac{n}{2}}^2) &\text{if } x \text{ is even} \\
F_{n-1}+\sum_{i=2}^{\frac{n-1}{2}}F_iF_{n-i} & \text{if }x \text{ is odd} 
\end{cases}
\end{equation}
with \(F_2=1\)

\section{Rooted Trees}
The next step toward enumerating general trees is to enumerate rooted trees. Rooted trees are trees that start with a root node (represented by a square). Unlike planted trees, rooted trees can have more than one branch attached to it. An example of a rooted tree is shown in figure 7.

\begin{figure}
\centering
\begin{tikzpicture}
[scale=.7]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (5,1) {};
\node [circ] (n2) at (3,3) {};
\node [circ] (n3) at (5,3) {};
\node [circ] (n4) at (7,3) {};
\node [circ] (n5) at (3,5) {};
\node [circ] (n6) at (4,5) {};
\node [circ] (n7) at (6,5) {};

\foreach \from/\to in {n1/n2,n1/n3,n1/n4,n2/n5,n3/n6,n3/n7}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{A rooted tree}
\end{figure}

We can expand upon our knowledge of planted trees to count rooted trees. Clearly, we can construct rooted trees by decorating the root node with 0, 1, 2 or 3 planted trees (Fig. 8). Let \(R(x)\) be a power series with coefficients \(R_n\) being the number on rooted trees with n nodes. Using Polya's Enumeration Theorem, we can get a functional equation for \(R(x)\) in terms of \(F(x)\) by decorating the root node with 0, 1, 2, or 3 planted trees. 

\begin{figure}[h]
\centering
\begin{tikzpicture}
[scale=.7]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw,minimum size=.35cm}}
\node [sq] (n1) at (1,1) {};
\node at (2.5,1) {,};
\node [sq]  (n2) at (4,1) {};
\node (n3) at (4,3) {};
\node at (5.5,1) {,};
\node [sq] (n4) at (7,1) {};
\node (n5) at (6,3) {};
\node (n6) at (8,3) {};
\node at (9,1) {,};
\node [sq] (n7) at (11,1) {};
\node (n8) at (9,3) {};
\node (n9) at (11,3) {};
\node (n10) at (13,3) {};

\foreach \from/\to in {n2/n3,n4/n5,n4/n6,n7/n8,n7/n9,n7/n10}
	\draw [dashed] (\from) -- (\to);
\end{tikzpicture}
\caption{4 ways to decorate the root node: 0, 1, 2  or 3 planted trees}
\end{figure}

The Functional equation we get from constructing rooted trees this way is
\begin{equation}
R(x)=x\Big(1+\frac{F(x)}{x}+\frac{1}{x^2}Z_{S_2}(F(x),F(x^2)) +\frac{1}{x^3}Z_{S_3}(F(x),F(x^2),F(x^3))\Big)
\end{equation}

	Let us break Eq. 23 down term by term. The x out front comes fron counting the root node. The 4 terms inside the parenthesis come from the 4 ways to decorate with planted trees. The 1 comes from decorating with 0 nodes. Clearly there is only one way to do this. The second term, \(\frac{F(x)}{x}\) comes from adding one planted tree. The number of ways to add one planted tree is simply the number of planted trees represented by \(F(x)\). The \(\frac{1}{x}\) comes from the fact that when we add the base node from the planted tree on top of the root node we over count the number of nodes by one. The third term in the parenthesis comes from adding 2 planted trees. The fact that we can swap the positions of the two added trees and we get the same resulting graph gives us a permuataion group for the added trees of \(S_2\) so we enumerate these graphs using Polya's Enumeration Theorem. The \(\frac{1}{x^2}\) comes from over countingn the base nodes added on top of the root nodes. Finally, the last term comes from adding 3 trees. Again we may swap any of the added trees with any of the other trees resulting in a permutation group \(S_3\). Again we use polya's enumeration theorem and divide by \(x^3\) to adjust for over counting the base nodes. 
	
	We can simplify this equation immediately. If we recall the Functional equation for F(x) in the form it was in in Eq. 12, we can see the first 3 terms in equation 23 are equal to \(\frac{F(x)}{x^2}\). We can then make the following substitution to get
\begin{equation}
R(x)=x\Big(\frac{F(x)}{x^2} +\frac{1}{x^3}Z_{S_3}(F(x),F(x^2),F(x^3))\Big)
\end{equation}

Now we must find the cycle index for \(S_3\). Write \(S_3\) in cyclic notation as:
\begin{equation}
S_3=\{e,(12),(13),(23),(123),(321)\}
\end{equation}
So we can easily compute its cycle index
\begin{equation}
Z_{S_3}=\frac{1}{6}(S_1^3+3S_2^1S_1^1+2S_3^1)
\end{equation}
Then we can rewrite Eq. 24 with this cycle index as
\begin{equation}
R(x)=x\Big(\frac{F(x)}{x^2} +\frac{1}{6x^3}(F^3(x)+3F(x^2)F(x)+2F(x^3))\Big)
\end{equation}
And finally with a little simplification we get:
\begin{equation}
R(x)=\frac{F(x)}{x} +\frac{F^3(x)}{6x^3}+\frac{F(x^2)F(x)}{2x^2}+\frac{F(x^3)}{3x^2}
\end{equation}

 Now let us substitute the respective power series for \(R(x)\) and \(F(x)\) and derive a relationship between the coefficients.
\begin{equation}
\sum_{n=0}^\infty R_nx^n= \frac{1}{x}\sum_{n=0}^\infty F_nx^n +\frac{1}{6x^2}\Big(\sum_{n=0}^\infty F_nx^n \Big)^3+\frac{1}{2x^2}\Big(\sum_{n=0}^\infty F_nx^{2n} \Big)\Big(\sum_{m=0}^\infty F_mx^m \Big) +\frac{1}{3x^2}\sum_{n=0}^\infty F_nx^{3n}
\end{equation}
With a little simplification we get\begin{equation}
\sum_{n=0}^\infty R_nx^n= \sum_{n=0}^\infty F_nx^{n-1} +\frac{1}{6}\sum_{i=0}^\infty \sum_{j=0}^\infty \sum_{k=0}^\infty  F_iF_jF_kx^{i+j+k-2}+\frac{1}{2}\sum_{i=0}^\infty \sum_{j=0}^\infty F_iF_jx^{i+2J-2} +\frac{1}{3}\sum_{n=0}^\infty F_nx^{3n-2}
\end{equation}
Then we equate the like powers of x:
\begin{equation}
 R_nx^n=  F_{n+1}x^n +\frac{1}{6}\sum_{i=0}^{n+2} \sum_{j=0}^{n+2-i} F_iF_jF_{n+2-i-j}x^n+\frac{1}{2}\sum_{i=0}^{n+2}  F_iF_{\frac{n-i}{2}+1}x^n+\frac{1}{3} F_{\frac{n+2}{3}}x^n
\end{equation}
Then we cancel the \(x^n\)s and get our final formula for rooted trees.
\begin{equation}
 R_n=  F_{n+1} +\frac{1}{6}\sum_{i=0}^{n+2} \sum_{j=0}^{n+2-i} F_iF_jF_{n+2-i-j}+\frac{1}{2}\sum_{i=0}^{n+2}  F_iF_{\frac{n-i}{2}+1}+\frac{1}{3} F_{\frac{n+2}{3}} \quad \text{Where } F_q=0 \text{ if } q \notin \mathbb{Z}
\end{equation}

\section{General Trees}
We are almost in a position where we are able to enumerate general trees but before we can do this we must develop a few new concepts. 
	First, we will define what it means for two nodes to be similar. Two nodes, a and b, on a graph g, are said to be similar if there exists an element in the permutation group \(P_g\) such that a and b appear next to each other in the permutation. In other words, two points are similar if they exchange places in a permuataion of the graph (Figure 9). Similarity is an equivalence relation on the set of nodes of g and therefor forms a partition on the set of nodes. We can divide the nodes into subsets where every node in each subsets is eqivalent to one another. These groups are called node similarity classes and we define \(p_g^*\) to be the number of similarity classes for a graph g. 

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.8, every node/.style={circle,draw}]
\node (n1) at (1,7) {a};
\node (n2) at (1,3) {b};
\node (n3) at (3,5) {};
\node (n4) at (6,5) {};
\node (n5) at (8,7) {};
\node (n6) at (8,3) {};

\node (n7) at (11,7) {b};
\node (n8) at (11,3) {a};
\node (n9) at (13,5) {};
\node (n10) at (16,5) {};
\node (n11)at (18,7) {};
\node (n12) at (18,3) {};

\foreach \from/\to in {n1/n3,n2/n3,n3/n4,n4/n5,n4/n6,n7/n9,n8/n9,n9/n10,n10/n11,n10/n12}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{a and b are similar nodes because they are allowed to swap places}
\end{figure} 

Next we will define what it means if two edges are similar. We say two edges are similar if thier end points are belong to the same node similarity classes (Fig. 10) Edge similarity is an equivalence relation on the set of edges in a graph g. We can therefore partition the set of edges into edge similarity classes just as we did with nodes. We will define\(q_g^*\) to be the number of edge similarity classes.

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.8]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (1,7) {};
\node at (1.75,4.15) {a};
\node at (1.75, 5.85) {b};
\node [circ] (n2) at (1,3) {};
\node [circ] (n3) at (3,5) {};
\node [circ] (n4) at (6,5) {};
\node [circ] (n5) at (8,7) {};
\node [circ] (n6) at (8,3) {};

\node [circ] (n7) at (11,7) {};
\node at (11.75,4.15) {b};
\node at (11.75, 5.85) {a};
\node [circ] (n8) at (11,3) {};
\node [circ] (n9) at (13,5) {};
\node [circ] (n10) at (16,5) {};
\node [circ] (n11)at (18,7) {};
\node [circ] (n12) at (18,3) {};

\foreach \from/\to in {n1/n3,n2/n3,n3/n4,n4/n5,n4/n6,n7/n9,n8/n9,n9/n10,n10/n11,n10/n12}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{a and b are similar edges}
\end{figure}
 
To provide an intuitive image of what these node and edge similarity classes look like, Figure 11 shows a graph where nodes and edges with the same labels are in the same similarity classes.

\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.8]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (1,1) {1};
\node [circ] (n2) at (1,3) {1};
\node [circ] (n3) at (1,5) {1};
\node [circ] (n4) at (1,7) {1};
\node [circ] (n5) at (3,6) {2};
\node [circ] (n6) at (3,2) {2};
\node [circ] (n7) at (5,4) {3};
\node [circ] (n8) at (8,4) {3};
\node [circ] (n9) at (10,6) {2};
\node [circ] (n10) at (10,2) {2};
\node [circ] (n11) at (12,1) {1};
\node [circ] (n12) at (12,3) {1};
\node [circ] (n13) at (12,5) {1};
\node [circ] (n14) at (12,7) {1};

\node at (3.75,3.15) {b};
\node at (3.75, 4.85) {b};
\node at (9.25,3.15) {b};
\node at (9.25, 4.85) {b};
\node at (2,1.25) {a};
\node at (2,2.75) {a};
\node at (2,5.25) {a};
\node at (2,6.75) {a};
\node at (11,1.25) {a};
\node at (11,2.75) {a};
\node at (11,5.25) {a};
\node at (11,6.75) {a};
\node at (6.5,4.25) {c};

\foreach \from/\to in {n1/n6,n2/n6,n3/n5,n4/n5,n5/n7,n6/n7,n7/n8,n8/n9,n8/n10,n10/n11,n10/n12,n9/n13,n9/n14}
	\draw (\from) -- (\to);

\end{tikzpicture}
\caption{A tree labeled according to similarity classes}
\end{figure}

Now we wish to define a special type of edge called a symmetry edge. A symmetry edge is an edge who's end nodes are in the same similarity class. Intuitvely, if we were to draw a dashed line down the middle of a symmetry line, the graph would be symmetric. An example of a symmetry line is the "c" line from figure 11. For any graph g, we define \(s_g\) to be the number of symmetry lines.

It may not be clear, but to enumerte trees, we need to derive a relationship between \(p_g^*\), \(q_g^*\) and \(s_g\). to do this we will first show that for any tree:
\begin{equation}
s_g=0 \; \text{or}  \;1
\end{equation}
Let us suppose we have a tree with two symmetry lines:
\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (3,1) {1};
\node [circ] (n2) at (5,3) {2};
\node [circ] (n3) at (7,1) {3};
\node (n4) at (1,0) {};
\node (n5) at (9,0) {};
\node (n6) at (1,2) {};
\node (n7) at (9,2) {};

\foreach \from/\to in {n1/n2,n2/n3}
	\draw (\from) -- (\to);
\foreach \from/\to in {n4/n1,n6/n1,n5/n3,n7/n3}
	\draw [dashed] (\from) -- (\to);

\end{tikzpicture}
\caption{A tree with two (non-dashed) symmetry lines. note: all three nodes are similar }
\end{figure}
If those 3 nodes are similar then there must be some way to swap thier lables while keeping the edge set constant. Clearly, we are able to swap 1 and 3 while maintaining the edge set. But since all three are similar we must be able to swap 2 with 1 or 3. Lets look at every possible rearrangement of the three nodes by applying every element of \(S_3\) (except the identity) to the nodes and seeing if we can find such permutations. 
\begin{center}
\begin{tabular}[!h]{|  l | c |  r | }
\hline
Permutation & Resulting Tree & Resluting Edge Set \\ \hline
(12) & \begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (0,0) {2};
\node [circ] (n2) at (2,2) {1};
\node [circ] (n3) at (4,0) {3};
\foreach \from/\to in {n1/n2,n2/n3} \draw (\from) -- (\to);
\end{tikzpicture} & \{(1,2),(1,3)\} \\ \hline
(13) & \begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (0,0) {3};
\node [circ] (n2) at (2,2) {2};
\node [circ] (n3) at (4,0) {1};
\foreach \from/\to in {n1/n2,n2/n3} \draw (\from) -- (\to);
\end{tikzpicture} & \{(1,2),(2,3)\} \\ \hline
(23) & \begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (0,0) {1};
\node [circ] (n2) at (2,2) {3};
\node [circ] (n3) at (4,0) {2};
\foreach \from/\to in {n1/n2,n2/n3} \draw (\from) -- (\to);
\end{tikzpicture} & \{(1,3),(2,3)\} \\ \hline
(123) & \begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (0,0) {3};
\node [circ] (n2) at (2,2) {1};
\node [circ] (n3) at (4,0) {2};
\foreach \from/\to in {n1/n2,n2/n3} \draw (\from) -- (\to);
\end{tikzpicture} & \{(1,3),(1,2)\} \\ \hline
(321) & \begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\node [circ] (n1) at (0,0) {2};
\node [circ] (n2) at (2,2) {3};
\node [circ] (n3) at (4,0) {1};
\foreach \from/\to in {n1/n2,n2/n3} \draw (\from) -- (\to);
\end{tikzpicture} & \{(2,3),(1,3)\} \\ \hline
\end{tabular}
\end{center}

The original edge set was\( \{ (1,2),(2,3)\}\) and the only permutation that preserved this edge set was (13) which does not involve 2. So, no permuataion that swaps 2 with 1 or 3 preserves the edge set so 2 is not similar to 1 or 3. We reach a contracdiction and we conclude that no such tree exists. We can similarly show that this happens if \(s_g\) = 3,4,5... and so on. Thus, a tree may only have 1 or 0 symmetry lines.

We may now derive a relation between \(p_g^*\), \(q_g^*\) and \(s_g\). Let g be any tree. Then we may lable the nodes by similarity classes 1,2,3,4,...,\(p_g^*\). We can then start listing some edge similarity classes: Edges that go (1,2), Edges that go (2,3), ... , Edges that go (\(p_g^*-1\),\(p_g^*\)). This subset of edge similarity classes, which we will call \(\mathscr{A}\), clearly has size \(p_g^*\). Now let us consider the two cases: \(s_g\)=0 and\( s_g\)=1. If \(s_g\)=0 then clearly the set \(\mathscr{A}\) constitues all of the edge similarity classes. It then follows that 
\begin{equation}
q_g^*=p_g^*-1\quad  \text{if } s_g =0
\end{equation}
	Similarly, if \(s_g=1\) then there is some edge similarity class that we havent counted which contains the symmetry line. Then clearly \(q_g^*= \mathscr{A}+1\) or equivalently
\begin{equation}
q_g^*=p_g^* \quad \text{if } s_g =1
\end{equation}
then combining the two equations, we get the general relation:
\begin{equation}
1=p_g^*-(q_g^*-s_g)
\end{equation}

Now we will use Eq 36 to derive a functional equation for \(T(x)\), a power series that has coefficients \(T_n\) being the number of trees with n nodes. Let us define \(\mathscr{T}_n\) to be the the set of trees with n nodes and let us perform a summation of Eq 36 over all elements g in \(\mathscr{T}_n\)
\begin{equation}
\sum_{g \in \mathscr{T}_n} 1=\sum_{g \in \mathscr{T}_n}p_g^*- \sum_{g \in \mathscr{T}_n}(q_g^*-s_g)
\end{equation}
Now lets examine each term closely. The left hand side will clearly result ing the magnitude of the set \(\mathscr{T}_n\) which is simple \(T_n\) so the left hand side becomes \(T_n\).

Next we first realize that the number of rooted trees that can be created from an unrooted tree is the same as the number of node similarity classes. If we were to consruct two rooted trees from two nodes from the same similarity class, they would be the same because the similarity of the end nodes requires that they are connected to all the other nodes in the same way. Thus we can think of \(p_g^*\) as the number of ways to make rooted trees from a single unrooted tree. So then the sum over all unrooted trees with n nodes will give us the total number of rooted trees with n nodes or more simply
\begin{equation}
\sum_{g \in \mathscr{T}_n}p_g^*=R_n
\end{equation}

Finally, we will look at the sum \(\sum_{g \in \mathscr{T}_n}(q_g^*-s_g)\). If \(s_g=0\) we may think of \(q_g^*\) as the number of trees that are rooted at edges in different similarity classes. And, if \(s_g=1\)  we may think of \(q_g^*-1\) as the number of rooted trees rooted at edges in different similarity classes that are not the symmetric class. In both cases then \((q_g^*-s_g)\) the number of rooted trees that can be constructed by rooting the trees at different edge similarity classes. and then clearly if we define\(L_n\) to be the number of trees with n nodes rooted at edges in different equivlence classes. then clearly 
\begin{equation}
\sum_{g \in \mathscr{T}_n}(q_g^*-s_g)= L_n
\end{equation} 
Combining all of this information we get the functional equation
\begin{equation}
T(x)=R(x)-L(x)
\end{equation}
The only problem is we dont yet know what L(x) is. Clearly, L(x) can be computed as 
\begin{equation}
L(x)=\text{(\# trees rooted at edges in different similarity classes)}-\text{(\# trees rooted at a symmetry edge)}
\end{equation}
We begin by noticing that if we take a tree and choose an edge we can split it into to two planted trees as show in figure 13. 
\begin{figure}[!h]
\centering
\begin{tikzpicture}
[scale=.5]
\tikzset{circ/.style={circle,draw}}
\tikzset{sq/.style={draw, minimum size=.35cm}}
\node [circ] (n1) at (1,7) {};
\node at (1.75,4.15) {a};
\node [circ] (n2) at (1,3) {};
\node [circ] (n3) at (3,5) {};
\node [circ] (n4) at (6,5) {};
\node [circ] (n5) at (8,7) {};
\node [circ] (n6) at (8,3) {};
\node [circ]  (n13) at (12,3) {};
\node [sq] (n14) at (14,5) {};
\node [circ] (n7) at (17,7) {};
\node [sq] (n8) at (17,3) {};
\node [circ] (n9) at (19,5) {};
\node [circ] (n10) at (22,5) {};
\node [circ] (n11)at (24,7) {};
\node [circ] (n12) at (24,3) {};
\node at (10,5) {=};
\node at (16,5) {+};

\foreach \from/\to in {n1/n3,n2/n3,n3/n4,n4/n5,n4/n6,n7/n9,n8/n9,n9/n10,n10/n11,n10/n12,n13/n14}
	\draw (\from) -- (\to);
\end{tikzpicture}
\caption{splitting a tree allong edge a into two smaller planted trees}
\end{figure}
 

Clearly, the two resulting trees will be the same for all ednes chosen in the same equivalence class so we may compute the number of trees rooted at edges in diferent similarity classes as the combinations of these two planted trees. By now it is easy to see that we can count these combinations using Polya's Enumeration Theorem and the symmetric group \(S_2\). We get:
\begin{equation}
\text{(\# trees rooted at edges in different similarity classes)}=\frac{1}{x^2}Z_{S_2}(F(x),F(x^2))=\frac{1}{2x^2}(F^2(x)+F(x^2))
\end{equation}
The \(\frac{1}{x^2}\) comes from the fact the the planted trees we get from splitting have a total of two extra nodes. 

Then notice that if we split the tree along a symmetry edge, we get the same planted tree on either side. So then 
\begin{equation}
\text{(\# trees rooted at a symmetry edge)}=\frac{F(x^2)}{x^2}
\end{equation}
We use \(F(x^2)\)  Because when we choose a planted tree we want it node count to double since we have two of them. combining these two equations we can get an expression for \(L(x)\)
\begin{equation}
L(x)= \frac{1}{2x^2}(F^2(x)-F(x^2))
\end{equation}
And we can then finally wirte our functional expresseion for \(T(x)\) as
\begin{equation}
T(x)=R(x) -\frac{F^2(x)}{2x^2}+\frac{F(x^2)}{2x^2}
\end{equation}
And then we can derive the functional form by pluggin in the power series, equating like powers of x and then canceling the \(x^n\) to get
\begin{equation}
T_n=R_n-\sum_{i=0}^nF_iF_{n+2-i} + F_{\frac{n}{2}+1}
\end{equation}
And we finally have a formula for enumerating trees!

\section{Counting Branch Points}
Now that we have derived the equations for planted, rooted, and unrooted Trees, it is not difficult to refine these equations to be able to count trees with more specific qualifications. For example, we can also enumerate graphs with a given number of nodes that also have a specific number of points with three edges emerging from it. To do this we will use a multivariate version of Polya's Enumeration Theorem to count both the branch nodes and the total nodes. This multivariate form introduces no new concepts into Polya's Enumeration Theorem and is an easy generaization from the single variable case. Simply put, it states:

Let G be a graph. Let \(F(x,y)\) be a power series 
\begin{equation}
F(x,y)=\sum_{i=0}^\infty \sum_{j=0}^\infty F_{ij} x^iy^j
\end{equation}
where \(F_{ij}\) is the number of ways to represent the graph with i of one object and j of another object. Then we may compute \(F(x,y)\) as
\begin{equation}
F(x,y)=Z_G(f(x,y),f(x^2,y^2),f(x^3,y^3)...)
\end{equation}
Where f(x,y) is the decoration function and \(Z_G\) is the cycle index. 

In this multivariate formulation, we will be using alot of double sums like the one in equation 47. It is convenient to define the notation:
\begin{equation}
\sum_{\substack{j=0\\i=0}}^{\substack{n\\m}} \equiv  \sum_{i=0}^n \sum_{j=0}^m
\end{equation}

We are now ready to begin counting trees. We will start again with planted trees and be careful to keep track of the branch nodes. We will let the power series
\begin{equation}
F(x,y)=\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b
\end{equation}
Be the generating function for planted trees and \(F_{nb}\) will be the number of planted trees with n nodes and b branch nodes. We can count these trees just as we did before by decorating the starting tree (tree with 2 nodes) with 0, 1, or 2 planted trees (Figure 6). When we do this using our new multivariate formulation of Polya's Enumeration Theorem we get a recursive functional equation that is nearly identical to the one we got before:
\begin{equation}
F(x,y)=x^2(1+\frac{F(x,y)}{x}+\frac{y}{x^2}(Z_{S_2}(F(x),F(x^2),F(x^3)...)))
\end{equation}
The only difference here is that we are using \(F(x,y)\) rather than \(F(x)\) and we have a \(y\) in the final term. This \(y\) comes from the fact that when we add two planted trees we are creating a branch node so we must increase the branch node count by one. 

We already know the cycle index for \(S_2\) so we can jump straight to the final functional equation:
\begin{equation}
F(x,y)=x^2+ xF(x,y)+\frac{y}{2}F^2(x,y)+\frac{y}{2}F(x^2,y^2)
\end{equation}
Now, just as we did before we will plug in our generating function for \(F(x,y)\) to find a recursive relationship for the \(F_{nb}\)'s:
\begin{equation}
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b =x^2+ x\Bigg(\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b\Bigg)+\frac{y}{2}\Bigg(\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b\Bigg)^2+\frac{y}{2}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{2n}y^{2b}
\end{equation} 
This equation can be easily simplifed as:
\begin{equation}
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b =x^2+ \sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{n+1}y^b+\frac{1}{2}\sum_{\substack{b_1=0\\n_1=0}}^{\substack{\infty\\ \infty}}\sum_{\substack{b_2=0\\n_2=0}}^{\substack{\infty\\ \infty}} F_{n_1b_1}F_{n_2b_2} x^{n_1+n_2}y^{b_1+b_2+1}+\frac{1}{2}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{2n}y^{2b}
\end{equation}
Now we must equate like powers of x and y to get:
\begin{equation}
 F_{nb} x^ny^b =x^2+  F_{n-1,b} x^ny^b+\frac{1}{2}\sum_{\substack{j=0\\i=0}}^{\substack{n\\ b-1}} F_{ij}F_{n-i,b-1-j} x^ny^b+\frac{1}{2} F_{\frac{n}{2},\frac{b-1}{2}} x^ny^b
\end{equation}
Then we simply cancel the \(x^ny^b\) to get our final recursion for the planted trees:
\begin{equation}
 F_{nb}  =F_{n-1,b}+\frac{1}{2}\sum_{\substack{j=0\\i=0}}^{\substack{n\\ b-1}} F_{ij}F_{n-i,b-1-j}+\frac{1}{2} F_{\frac{n}{2}\frac{b-1}{2}}
\end{equation}

Then, just as before, we can build upon our knowledge of planted trees to get a relation for rooted trees with a certain number of branch nodes. We will be decorating the root node with 0, 1, 2, or 3 planted trees (Figure 8), this time being careful to insert a \(y\) when ever we create a branch node. Notice that we create a branch node when we add 3 planted trees to the root node but not when we add 0,1,or 2 planted trees. So, we may start to formulate our functional equation as:
\begin{equation}
R(x,y)=x\Big(1+\frac{F(x,y)}{x}+\frac{1}{x^2}Z_{S_2}(F(x,y),F(x^2,y^2)) +\frac{y}{x^3}Z_{S_3}(F(x,y),F(x^2,y^2),F(x^3,y^3))\Big)
\end{equation}
We can solve equation 51 for \(\frac{1}{x^2}(Z_{S_2}(F(x),F(x^2),F(x^3)...)))\) and substitute into equation 57 to get:
\begin{equation}
R(x,y)=x\Big(1+\frac{F(x,y)}{x}+\frac{F(x,y)}{yx^2} -\frac{1}{y}- \frac{F(x,y)}{xy}+\frac{y}{x^3}Z_{S_3}(F(x,y),F(x^2,y^2),F(x^3,y^3))\Big)
\end{equation}
Then, we can multiply through by the \(x\) and substitute in the cycle indicies to get:
\begin{equation}
R(x,y)=x+F(x,y)+\frac{F(x,y)}{xy}-\frac{x}{y}-\frac{F(x,y)}{y} +\frac{yF^3(x,y)}{6x^2}+\frac{yF(x^2,y^2)F(x,y)}{2x^2}+\frac{yF(x^3,y^3)}{3x^2}
\end{equation}
We can put in the appropriate generating functions to relate the coefficients:
\begin{align}
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} R_{nb} x^ny^b= &
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b+
\frac{1}{xy}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b-
\frac{1}{y}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b +
\frac{y}{6x^2}\Bigg(\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b\Bigg)^3 \nonumber \\
&+\frac{y}{2x^2}\Bigg(\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{2n}y^{2b}\Bigg)\Bigg(\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b\Bigg)+
\frac{y}{3x^2}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{3n}y^{3b}
\end{align}
This can then be simplified as:
\begin{align}
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} R_{nb} x^ny^b= &
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^b+
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{n-1}y^{b-1}-
\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^ny^{b-1} \nonumber \\
&+\frac{1}{6}\sum_{\substack{b_1=0\\n_1=0}}^{\substack{\infty\\ \infty}}\sum_{\substack{b_2=0\\n_2=0}}^{\substack{\infty\\ \infty}}\sum_{\substack{b_3=0\\n_3=0}}^{\substack{\infty\\ \infty}} F_{n_1b_1}F_{n_2b_2}F_{n_3b_3} x^{n_1+n_2+n_3-2}y^{b_1+b_2+b_3} \nonumber \\
&+\frac{1}{2}\sum_{\substack{b_1=0\\n_1=0}}^{\substack{\infty\\ \infty}}\sum_{\substack{b_2=0\\n_2=0}}^{\substack{\infty\\ \infty}}  F_{n_1b_1}F_{n_2b_2}x^{2n_1+n_2-2}y^{2b_1+b_2+1}+
\frac{1}{3}\sum_{\substack{b=0\\n=0}}^{\substack{\infty\\ \infty}} F_{nb} x^{3n-2}y^{3b+1}
\end{align}
And then we can equate like powers of x and y.
\begin{align}
 R_{nb} x^ny^b= & F_{nb} x^ny^b+ F_{n+1,b+1} x^ny^b- F_{n,b+1} x^ny^b 
+\frac{1}{6}\sum_{\substack{j_1=0\\i_1=0}}^{\substack{n+2\\ b-1}}\sum_{\substack{j_2=0\\i_2=0}}^{\substack{n+2-i_1\\ b-1-j_1}}F_{j_1i_1}F_{i_2j_2}F_{n+2-i_1-i_2,b-1-j_1-j_2} x^ny^b \nonumber \\
&+\frac{1}{2}\sum_{\substack{j=0\\i=0}}^{\substack{n+2\\ b-1}} F_{ij}F_{\frac{n-i}{2},\frac{b-1-j}{2}}x^ny^b+
\frac{1}{3} F_{\frac{n+2}{3},\frac{b-1}{3}} x^ny^b
\end{align}
Finally, we cancel all of the x's and y's on both sides to get our final relation for rooted trees:
\begin{equation}
\small
 R_{nb}=  F_{nb}+ F_{n+1,b+1} - F_{n,b+1} 
+\frac{1}{6}\sum_{\substack{j_1=0\\i_1=0}}^{\substack{n+2\\ b-1}}\sum_{\substack{j_2=0\\i_2=0}}^{\substack{n+2-i_1\\ b-1-j_1}}F_{j_1i_1}F_{i_2j_2}F_{n+2-i_1-i_2,b-1-j_1-j_2} 
+\frac{1}{2}\sum_{\substack{j=0\\i=0}}^{\substack{n+2\\ b-1}} F_{ij}F_{\frac{n-i}{2},\frac{b-1-j}{2}}+
\frac{1}{3} F_{\frac{n+2}{3},\frac{b-1}{3}} 
\end{equation}

Finally, we wish to find an equation for unrooted trees. If we recall the process we used earlier, we first rooted trees at different similarity classes of nodes and then rooted them as differen similarity classes of edges. Clearly niether of these processes changes the branch node count on the original unrooted tree because we are not changing the structure of the graph in any way. Rather we are just thinking about the same graph in different ways. We can simply alter equation 37 and sum over the set of trees with n nodes and b branch nodes, \(\mathscr{T}_{nb}\)
\begin{equation}
\sum_{g \in \mathscr{T}_{nb}} 1=\sum_{g \in \mathscr{T}_{nb}}p_g^*- \sum_{g \in \mathscr{T}_{nb}}(q_g^*-s_g)
\end{equation}
Then the logic flows in exactly the same way as it did before and we arrive at the functional equation
\begin{equation}
T(x,y)=R(x,y) -\frac{F^2(x,y)}{2x^2}+\frac{F(x^2,y^2)}{2x^2}
\end{equation}
Which gives us the recursive relation:
\begin{equation}
T_{nb}=R_{nb}-\sum_{\substack{j=0\\i=0}}^{\substack{n+2\\ b-1}}F_{ij}F_{n+2-i,b-j} + F_{\frac{n}{2}+1,\frac{b}{2}}
\end{equation}
\end{document}
